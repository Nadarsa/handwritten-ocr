# Отчет по блоку «Первичный отбор и подготовка данных»

## Проблема

Задача блока данных заключалась в том, чтобы подготовить компактный, но репрезентативный датасет рукописного кириллического текста из открытых источников для последующего тестирования готовых OCR-моделей **без обучения**.

При этом исходные публичные датасеты сильно различаются по структуре:
- форматы аннотаций;
- организация папок;
- уровень предобработки.

---

## Алгоритм подготовки исходных данных

Задача подготовки данных была решена последовательностью трёх основных шагов:

1. анализ структур и выбор датасетов;
2. подготовка и отбор исходных сырых данных;
3. проектирование и массовое применение аугментаций.

---

## 1. Отбор и первичное исследование датасетов

Были найдены и локально загружены три источника данных:

- **HWR200** (HuggingFace, AntiplagiatCompany)  
  Крупный датасет рукописных сочинений с более чем 30 000 изображений, организованный в виде отдельных диапазонов файлов с раздельным хранением текстов и изображений.  
  Каждая текстовая аннотация описывает несколько фотографий одной и той же работы (скан, светлое фото, тёмное фото).

- **school_notebooks_ru** (HuggingFace, ai-forever)  
  Рукописные школьные тетради, аннотированные в COCO-подобном формате: для каждой страницы хранится список слов, размеченных полигонами с текстом.

- **Russian Handwritten Text.v7i.coco** (Roboflow)  
  Датасет с аннотациями `_annotations.coco.json`, где присутствуют `bbox` и `category_id`, но отсутствует сам текст внутри бокса, что делает его пригодным только для детекции, а не для оценки распознавания.

### Исследование структур

Структуры датасетов были исследованы двумя способами:

- визуальный просмотр содержимого папок и примеров изображений;
- технический анализ через ноутбук `01_analyze_dataset_structures.ipynb`.

### Принятые решения

По итогам анализа было принято решение:

- использовать в работе только два датасета: **HWR200** и **school_notebooks_ru**;
- не использовать датасет Roboflow из-за отсутствия текстовых меток.

---

## 2. Подготовка и отбор исходных сырых данных

### HWR200

Особенность HWR200 — **многие изображения на один текст**, а также сложная иерархия директорий.  
Для приведения датасета к удобному для команды формату была выполнена работа по переименованию и выравниванию структуры с помощью ноутбука: "02_rename_dataset_hwr200.ipynb"

После выравнивания структуры была проведена ручная фильтрация текстовых файлов:

- из каждого `.txt` удалены лишние фрагменты, чтобы каждый файл описывал ровно один фрагмент текста;
- из набора отобраны **117 оригинальных примеров**, для которых структура  
  «одна аннотация — один читаемый и содержательный фрагмент текста»  
  является корректной для дальнейшего тестирования моделей.

### school_notebooks_ru

Особенностью данного датасета является разметка каждого слова полигоном.  
Для удобства анализа и дальнейшего использования все полигоны были приведены к прямоугольным `bbox`.

Для целей кейса и с учётом ограничений по объёму:

- были отобраны **первые 300 исходных изображений** датасета;
- дополнительный программный фильтр по тексту не применялся.

Это позволило сохранить репрезентативность реальных школьных страниц при умеренном размере данных.

---

## 3. Проектирование и применение аугментаций

Аугментации выполнялись в отдельном ноутбуке: "03_augmentation.ipynb"


В результате исследования различных вариантов были отобраны **5 основных аугментаций**, наиболее близких к реальным искажениям изображений:

- **GaussNoise** (`"gauss"`)  
  Добавление гауссовского шума, имитирующего шум камеры или плохое освещение.

- **RandomBrightnessContrast** (`"bright"`)  
  Изменение яркости и контраста, делающее текст более или менее различимым.

- **MotionBlur** (`"motion"`)  
  Размытие изображения в одном направлении, имитирующее дрожание руки.

- **ElasticTransform** (`"elastic"`)  
  «Резиновые» искажения, имитирующие деформацию бумаги.

- **GridDistortion** (`"grid"`)  
  Сеточная деформация страницы с локальными искажениями сегментов.

Подбор параметров (яркость, контраст, шум, степень деформации) проводился эмпирически так, чтобы:

- заметно усложнить задачу распознавания;
- не уничтожить читаемость текста.

---

## Результаты массовой аугментации

### HWR200

- 117 исходных изображений;
- 5 типов аугментаций → 585 новых файлов;
- **итого: 702 изображения**  
  (117 оригиналов + 585 аугментированных).

### school_notebooks_ru

- 300 исходных изображений;
- 2 типа аугментаций (`"bright"` и `"grid"`) → 600 новых файлов  
  (часть исходных изображений использована выборочно для соблюдения целевого объёма);
- **итого: 900 изображений**  
  (300 оригиналов + 600 аугментированных).

### Суммарно

- 417 оригинальных + 1185 аугментированных;
- **1602 изображения**.

---

## Выводы (блок «Отбор и подготовка данных»)

1. Были найдены несколько открытых источников рукописного кириллического текста и проведён их структурный анализ, по итогам которого для дальнейшей работы отобраны два датасета: **HWR200** и **school_notebooks_ru**.
2. Структура обоих датасетов приведена к удобному для команды формату:
   - для HWR200 реализовано переименование и выравнивание текстовых и графических файлов, выполнен ручной отбор 117 качественных примеров;
   - для school_notebooks_ru отобраны 300 исходных изображений и сохранены аннотации в трёх взаимозаменяемых форматах.
3. На основе этих двух источников разработан и реализован пайплайн аугментации (5 сильных, но контролируемых типов искажений на базе **albumentations**), что позволило увеличить объём данных до **1602 изображений** с сохранением связи между оригиналами и аугментированными версиями через систему имён файлов.
4. Итоговая структура папок `data/raw` и `data/processed`, а также сопровождающий `readme.md`, делают датасет понятным и воспроизводимым для других участников проекта и внешних пользователей.
